<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE dmodule>
<dmodule xmlns:dc="http://www.purl.org/dc/elements/1.1/" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.s1000d.org/S1000D_5-0/xml_schema_flat/descript.xsd">
  <identAndStatusSection>
    <dmAddress>
      <dmIdent>
        <dmCode modelIdentCode="S1KDTOOLS" systemDiffCode="A" systemCode="25" subSystemCode="0" subSubSystemCode="0" assyCode="00" disassyCode="00" disassyCodeVariant="A" infoCode="040" infoCodeVariant="A" itemLocationCode="D"/>
        <language languageIsoCode="en" countryIsoCode="CA"/>
        <issueInfo issueNumber="026" inWork="00"/>
      </dmIdent>
      <dmAddressItems>
        <issueDate year="2020" month="01" day="03"/>
        <dmTitle>
          <techName>s1kd-refs</techName>
          <infoName>Description</infoName>
        </dmTitle>
      </dmAddressItems>
    </dmAddress>
    <dmStatus issueType="changed">
      <security securityClassification="01"/>
      <responsiblePartnerCompany>
        <enterpriseName>khzae.net</enterpriseName>
      </responsiblePartnerCompany>
      <originator>
        <enterpriseName>khzae.net</enterpriseName>
      </originator>
      <applic>
        <displayText>
          <simplePara>All</simplePara>
        </displayText>
      </applic>
      <brexDmRef>
        <dmRef>
          <dmRefIdent>
            <dmCode modelIdentCode="S1KDTOOLS" systemDiffCode="A" systemCode="00" subSystemCode="0" subSubSystemCode="0" assyCode="00" disassyCode="00" disassyCodeVariant="A" infoCode="022" infoCodeVariant="A" itemLocationCode="D"/>
          </dmRefIdent>
        </dmRef>
      </brexDmRef>
      <qualityAssurance>
        <unverified/>
      </qualityAssurance>
      <reasonForUpdate id="rfu-0001" updateHighlight="1" updateReasonType="urt02">
        <simplePara>Expand -w (--where-used) functionality.</simplePara>
      </reasonForUpdate>
    </dmStatus>
  </identAndStatusSection>
  <content>
    <description>
      <levelledPara>
        <title>General</title>
        <para>The <emphasis>s1kd-refs</emphasis> tool lists external references in CSDB objects, optionally matching them to a filename in the CSDB directory hierarchy.</para>
        <para>This allows you to:</para>
        <para>
          <randomList>
            <listItem>
              <para>obtain a list of dependencies for CSDB objects, such as ICNs, to ensure they are delivered together</para>
            </listItem>
            <listItem>
              <para>check for references to objects which do not exist in the current CSDB</para>
            </listItem>
            <listItem>
              <para>update reference metadata, such as titles, from the matched objects</para>
            </listItem>
          </randomList>
        </para>
      </levelledPara>
      <levelledPara>
        <title>Usage</title>
        <para>
          <verbatimText verbatimStyle="vs24">s1kd-refs [-aCcDEFfGHIiLlmNnoPqRrSsTUuvwXxh?] [-d &lt;dir&gt;] [-e &lt;cmd&gt;]
          [-J &lt;ns=URL&gt;] [-j &lt;xpath&gt;] [-t &lt;fmt&gt;] [-3 &lt;file&gt;]
          [&lt;object&gt;...]</verbatimText>
        </para>
      </levelledPara>
      <levelledPara>
        <title>Options</title>
        <para>
          <definitionList>
            <definitionListItem>
              <listItemTerm>-a, --all</listItemTerm>
              <listItemDefinition>
                <para>List all references, both matched and unmatched.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-C, -D, -E, -G, -H, -L, -P, -S, -T</listItemTerm>
              <listItemDefinition>
                <para>List references to comments, data modules, external publications, ICNs, hotspots, data management lists, publication modules, SCORM content packages and referred fragments respectively. If none are specified, -CDEGHLPST is assumed.</para>
                <para>The following long options can also be used for each: --com, --dm, --epr, --icn, --hotspot, --dml, --pm, --smc, --fragment.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-c, --content</listItemTerm>
              <listItemDefinition>
                <para>List references in the <verbatimText verbatimStyle="vs12">content</verbatimText> section of a CSDB object only.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-d, --dir &lt;dir&gt;</listItemTerm>
              <listItemDefinition>
                <para>Directory to search for matches to references in. By default, the current directory is used.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-e, --exec &lt;cmd&gt;</listItemTerm>
              <listItemDefinition>
                <para>Execute a command for each referenced CSDB object matched. The string "{}" is replaced by the current CSDB object file name everywhere it occurs in the arguments to the command.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-F, --overwrite</listItemTerm>
              <listItemDefinition>
                <para>When using the -U or -X options, overwrite the input objects that have been updated or tagged.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-f, --filename</listItemTerm>
              <listItemDefinition>
                <para>Include the filename of the source object where each reference was found in the output.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-h, -?, --help</listItemTerm>
              <listItemDefinition>
                <para>Show help/usage message.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-I, --update-issue</listItemTerm>
              <listItemDefinition>
                <para>Update the issue number, issue date, language, and title of references to that of the latest matched object. This option implies the -U and -i options.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-i, --ignore-issue</listItemTerm>
              <listItemDefinition>
                <para>Ignore issue info when matching. This will always match the latest issue of an object found, regardless of the issue specified in the reference.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-J &lt;ns=URL&gt;</listItemTerm>
              <listItemDefinition>
                <para>Registers an XML namespace prefix, which can then be used in the hotspot XPath expression (-j). Multiple namespaces can be registered by specifying this option multiple times.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-j &lt;xpath&gt;</listItemTerm>
              <listItemDefinition>
                <para>Specify a custom XPath expression to use when matching hotspots (-H) in XML-based ICN formats.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-l, --list</listItemTerm>
              <listItemDefinition>
                <para>Treat input (stdin or arguments) as lists of filenames of CSDB objects to list references in, rather than CSDB objects themselves.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-m, --strict-match</listItemTerm>
              <listItemDefinition>
                <para>Be more strict when matching codes of CSDB objects to filenames. By default, the name of a file (minus the extension) only needs to start with the code to be matched. When this option is specified, the name must match the code exactly.</para>
                <para>For example, the code "ABC" will normally match either of the files "ABC.PDF" or "ABC_1.PDF", but when strict matching is enabled, it will only match the former.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-N, --omit-issue</listItemTerm>
              <listItemDefinition>
                <para>Assume filenames of referenced CSDB objects omit the issue info, i.e. they were created with the -N option to the s1kd-new* tools.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-n, --lineno</listItemTerm>
              <listItemDefinition>
                <para>Include the filename of the source object where each reference was found, and display the line number where the reference occurs in the source file after its filename.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-o, --output-valid</listItemTerm>
              <listItemDefinition>
                <para>Output valid CSDB objects to stdout.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-q, --quiet</listItemTerm>
              <listItemDefinition>
                <para>Quiet mode. Errors are not printed.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-R, --recursively</listItemTerm>
              <listItemDefinition>
                <para>List references in matched objects recursively.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-r, --recursive</listItemTerm>
              <listItemDefinition>
                <para>Search for matches to references in directories recursively.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-s, --include-src</listItemTerm>
              <listItemDefinition>
                <para>Include the source object as a reference. This is helpful when the output of this tool is used to apply some operation to a source object and all its dependencies together.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-t, --format &lt;fmt&gt;</listItemTerm>
              <listItemDefinition>
                <para>Specify a custom format for printed references. &lt;fmt&gt; is a format string, where the following variables can be given:</para>
                <para>
                  <randomList>
                    <listItem>
                      <para>%line% - The line number where the reference occurs in the source.</para>
                    </listItem>
                    <listItem>
                      <para>%ref% - The reference.</para>
                    </listItem>
                    <listItem>
                      <para>%src% - The source of the reference.</para>
                    </listItem>
                    <listItem>
                      <para>%xpath% - The XPath denoting where the reference occurs in the source.</para>
                    </listItem>
                  </randomList>
                </para>
                <para>For example, <verbatimText>-t '%src% (%line%): %ref%'</verbatimText> is equivalent to the -n option.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-U, --update</listItemTerm>
              <listItemDefinition>
                <para>Update the title of matched references from the corresponding object.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-u, --unmatched</listItemTerm>
              <listItemDefinition>
                <para>Show only unmatched reference errors, or unmatched codes if combined with the -a option.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-v, --verbose</listItemTerm>
              <listItemDefinition>
                <para>Verbose output.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-w, --where-used</listItemTerm>
              <listItemDefinition>
                <para>Instead of listing references contained within specified objects, list places within other objects where the specified objects are referenced.</para>
                <para changeMark="1" changeType="add" reasonForUpdateRefIds="rfu-0001">In this case, &lt;object&gt; may also be a code (with the appropriate prefix) instead of an actual file. For example: <verbatimText>s1kd-refs -w DMC-TEST-A-00-00-00-00A-040A-D</verbatimText></para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-X, --tag-unmatched</listItemTerm>
              <listItemDefinition>
                <para>Tag unmatched references with the processing instruction <verbatimText>&lt;?unmatched?&gt;</verbatimText>.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-x, --xml</listItemTerm>
              <listItemDefinition>
                <para>Output a detailed XML report instead of plain text messages.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>-3, --externalpubs &lt;file&gt;</listItemTerm>
              <listItemDefinition>
                <para>Use a custom <verbatimText verbatimStyle="vs02">.externalpubs</verbatimText> file.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>--version</listItemTerm>
              <listItemDefinition>
                <para>Show version information.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>&lt;object&gt;...</listItemTerm>
              <listItemDefinition>
                <para>CSDB object(s) to list references in. If none are specified, the tool will read from stdin.</para>
              </listItemDefinition>
            </definitionListItem>
          </definitionList>
        </para>
        <para>In addition, the following options enable features of the XML parser that are disabled as a precaution by default:</para>
        <para>
          <definitionList>
            <definitionListItem>
              <listItemTerm>--dtdload</listItemTerm>
              <listItemDefinition>
                <para>Load the external DTD.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>--net</listItemTerm>
              <listItemDefinition>
                <para>Allow network access to load external DTD and entities.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>--noent</listItemTerm>
              <listItemDefinition>
                <para>Resolve entities.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>--xinclude</listItemTerm>
              <listItemDefinition>
                <para>Do XInclude processing.</para>
              </listItemDefinition>
            </definitionListItem>
          </definitionList>
        </para>
        <levelledPara>
          <title><verbatimText verbatimStyle="vs02">.externalpubs</verbatimText> file</title>
          <para>The <verbatimText verbatimStyle="vs02">.externalpubs</verbatimText> file contains definitions of external publication references. This can be used to update external publication references in CSDB objects with -U.</para>
          <para>By default, the tool will search the current directory and parent directories for a file named .externalpubs, but any file can be specified by using the -e option.</para>
          <para>Example of a <verbatimText verbatimStyle="vs02">.externalpubs</verbatimText> file:
            <verbatimText verbatimStyle="vs11">&lt;externalPubs&gt;
&lt;externalPubRef&gt;
&lt;externalPubRefIdent&gt;
&lt;externalPubCode&gt;ABC&lt;/externalPubCode&gt;
&lt;externalPubTitle&gt;ABC Manual&lt;/externalPubTitle&gt;
&lt;/externalPubRefIdent&gt;
&lt;/externalPubRef&gt;
&lt;/externalPubs&gt;</verbatimText></para>
          <para>External publication references will be updated whether they are matched to a file or not.</para>
        </levelledPara>
        <levelledPara>
          <title>Hotspot matching (-H)</title>
          <para>Hotspots can be matched in XML-based ICN formats, such as SVG or X3D. By default, matching is based on the APS ID of the hotspot and the following attributes:</para>
          <para>
            <definitionList>
              <definitionListItem>
                <listItemTerm>SVG</listItemTerm>
                <listItemDefinition>
                  <para>
                    <verbatimText verbatimStyle="vs13">@id</verbatimText>
                  </para>
                </listItemDefinition>
              </definitionListItem>
              <definitionListItem>
                <listItemTerm>X3D</listItemTerm>
                <listItemDefinition>
                  <para>
                    <verbatimText verbatimStyle="vs13">@DEF</verbatimText>
                  </para>
                </listItemDefinition>
              </definitionListItem>
            </definitionList>
          </para>
          <para>If hotspots are identified in a different way in a project's ICNs, a custom XPath expression can be specified with the -j option. In this XPath expression, the variable <verbatimText verbatimStyle="vs01">$id</verbatimText> represents the hotspot APS ID:</para>
          <para>
            <verbatimText verbatimStyle="vs24">$ s1kd-refs -H -j "//*[@attr = $id]" &lt;DM&gt;</verbatimText>
          </para>
        </levelledPara>
      </levelledPara>
      <levelledPara>
        <title>Exit status</title>
        <para>
          <definitionList>
            <definitionListItem>
              <listItemTerm>0</listItemTerm>
              <listItemDefinition>
                <para>No errors, all references were matched.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>1</listItemTerm>
              <listItemDefinition>
                <para>Some references were unmatched.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>2</listItemTerm>
              <listItemDefinition>
                <para>The number of objects found in a recursive check (-R) exceeded the available memory.</para>
              </listItemDefinition>
            </definitionListItem>
            <definitionListItem>
              <listItemTerm>3</listItemTerm>
              <listItemDefinition>
                <para>stdin did not contain valid XML and not in list mode (-l).</para>
              </listItemDefinition>
            </definitionListItem>
          </definitionList>
        </para>
      </levelledPara>
      <levelledPara>
        <title>Example</title>
        <para>
          <verbatimText verbatimStyle="vs24">$ s1kd-refs DMC-EX-A-00-00-00-00A-040A-D_000-01_EN-CA.XML
DMC-EX-A-00-00-00-00A-022A-D_001-00_EN-CA.XML
DMC-EX-A-01-00-00-00A-040A-D_000-01_EN-CA.XML
ICN-12345-00001-001-01.JPG</verbatimText>
        </para>
      </levelledPara>
    </description>
  </content>
</dmodule>
